@page "/authenticated/randifier"

@inherits Spotify.Pages.Authenticated.RandifierPage

@if (!Loaded)
{
    <div class="row">
        <div class="col-sm-4 col-md-8 col-lg-12">
            <h3>Loading playlists from Spotify ...</h3>
        </div>
    </div>

    return;
}

<div class="row">
    <div class="col-sm-4 col-md-4 col-lg-4">
        <h3>Playlists</h3>
        <br />
        <div class="list-group">
            @if (Playlists.Any())
            {
                <select onchange=@BindPlaylist class="form-control">
                    <option selected> </option>
                    @foreach (var playlist in Playlists)
                    {
                        if (CurrentPlaylist != null && CurrentPlaylist.Id == playlist.Id)
                        {
                            <option id="@playlist.Id" selected value="@playlist.Id">@playlist.Name</option>
                        }
                        else
                        {
                            <option id="@playlist.Id" value="@playlist.Id">@playlist.Name</option>
                        }
                    }
                </select>
            }
            else
            {
                <p>Opps, no Playlists to Randify ...</p>
            }
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-12 col-md-12 col-lg-12">
        @if (IsPlaylistLoading)
        {
            <br />
            <h3>Playlist Loading ... (@NumberOfLoadedTracks tracks in @Seconds seconds)</h3>
            <p>See the About page for details regarding slow loading ...</p>
        }
        else
        {
            @if (CurrentPlaylist != null)
            {
                <br />
                <div class="row">
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h3>@CurrentPlaylist.Name (@NumberOfLoadedTracks tracks)</h3>
                    </div>
                    <div class="col-sm-4 col-md-4 col-lg-4">
                        @if (PlaylistTracks.Any())
                        {
                            <button type="button" class="btn btn-primary pull-right" onclick=@(() => Randify())>Randify!</button>
                        }
                    </div>
                </div>
                @if (PlaylistTracks.Any())
                {
                    <table class="table table-striped table-light">
                        <thead class="thead-dark">
                            <tr>
                                <td scope="col"></td>
                                <td scope="col">
                                    Title
                                </td>
                                <td scope="col">
                                    Artist
                                </td>
                                <td class="hidden-xs hidden-sm" scope="col">
                                    Album
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var playlistTrack in PlaylistTracks)
                            {
                                <tr>
                                    <td class="align-middle">
                                        @if (WebPlaybackState != null && !WebPlaybackState.Paused && CurrentlyPlayingTrack.Id == playlistTrack.Track.Id)
                                        {
                                            //<button class="playbutton" onclick=@TogglePlay()><i class="fa fa-pause"></i></button>
                                        }
                                        else
                                        {
                                            //<button class="playbutton" onclick=@Play(playlistTrack.Track)><i class="fa fa-play"></i></button>
                                        }
                                    </td>
                                    <td class="align-middle">
                                        @playlistTrack.Track.Name
                                    </td>
                                    <td class="align-middle">
                                        @playlistTrack.Track.Artists[0].Name
                                    </td>
                                    <td class="hidden-xs hidden-sm align-middle">
                                        @playlistTrack.Track.Album.Name
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <br />
                    <br />
                    <p>Opps, no tracks to Randify ...</p>
                }
            }
            else if (CurrentPlaylist == null && Playlists.Any())
            {
                <br />
                <h3>Select a Playlist ...</h3>
            }
            else
            {
                <br />
                <p>Opps, no tracks to Randify ...</p>
            }
        }
    </div>
</div>

<Error Exception=@PageException />
